# AI 매매 프로그램 개발 로드맵

## 1. 프로젝트 개요

- **목적**: 횡보/상승 구간에서 소규모 반복 수익 극대화 + 하락장 리스크 관리
- **거래소**: Upbit (현물, KRW 마켓 가정)
- **방식**: 규칙 기반 자동매매(1차) → 데이터 기반 개선(2차~)
- **수수료**: 매수/매도 각 0.05% (왕복 0.1%) 반영

---

## 2. 기능 범위 (스코프)

### ✅ 1차 버전 (즉시 구현)

**핵심 전략(기본 자동 기능)**

- 최초 세션 특별 로직: 호가 타이밍 매수 → +0.3% 도달 시 1회 한정 매도
- 반복 루프(횡보 대응):
  1. 자동/최초 매도 이후: 현재가 기준 -0.4% 재매수
  2. 매수 체결가 대비 +0.8% 도달 시 매도 → 반복
  3. 30분마다 전량 정리(또는 포지션 없으면 초기화) 후, 해당 시점 가격을 기준으로 1)~2) 재시작
- 하락장 리스크 관리:
  - 손절: 매수가 대비 -0.8% 하락 시 손절 매도
  - 손절 트리거 발생 시 봇 정지 30분 → 재개
  - 연속 손절 2회/일 발생 시 당일 거래 정지 + 알림
- 기술지표 트리거:
  - RSI ≥ 85 → 강제 매도
  - 볼린저 상단 터치 → 강제 매도 / 하단 터치 → 강제 매수
- 알림: 텔레그램/슬랙/이메일 (오류, 손절, 일시정지, 체결 요약)
- 실행/복구: 24시간 운영(PM2/Docker) + 상태 복원
- 안전장치: 최소 주문 금액/잔고 확인, 미체결 정리, 중복 주문 방지, 슬리피지 체크
- 설정 파일화(.env/.yaml): 퍼센트 값, 쿨다운, 손절 횟수, 주문 금액 등

---

### ⏳ 2차 버전 (단기 확장: 난이도 중)

- “매도 후 3% 추가 상승 감지” 실시간 알림
- “1분 30초 내 4회 이상 체결” 시 특수 모드 전환 (rate limit 고려)
- 전략 파라미터 자동 튜닝 (백테스트 기반)
- 간단한 상승/횡보/하락 구분 로직 추가 (ATR, ADX, RSI 조합)

---

### 🔬 3차 버전 (중장기 확장: 난이도 높음)

- 김치 프리미엄 기반 트리거 (해외 거래소 + 환율 데이터 필요)
- ML/강화학습 기반 시장 상태 판정 및 전략 자동 전환
- 실시간 대시보드 (체결/PNL/승률/드로우다운)
- 다심볼 분산, 리밸런싱, 이벤트 리스크 회피

---

## 3. 기술 설계 (요약)

### 아키텍처

- **Core**: 시세 구독 → 신호(전략) → 주문 라우터 → 체결/상태머신 → 리스크/알림
- **State**: 포지션 상태, 체결 히스토리, 쿨다운 타이머
- **모듈**:
  - exchange: Upbit API 래퍼, rate-limit 관리
  - strategy: 규칙 기반 시그널
  - risk: 손절 횟수, 손실 한도, 주문 락
  - scheduler: 30분 주기 초기화, 데일리 리셋
  - notifier: Telegram/Slack/Email
  - storage: SQLite/PostgreSQL/JSON 파일

### 주요 파라미터 예시 (.env/.yaml)

```yaml
SYMBOL: KRW-BTC
ORDER_SIZE_KRW: 20000
TAKE_PROFIT_PCT: 0.008 # +0.8%
REBUY_DROP_PCT: 0.004 # -0.4%
FIRST_TP_PCT: 0.003 # +0.3% (첫 회만)
STOP_LOSS_PCT: -0.008 # -0.8%
COOLDOWN_MIN: 30
MAX_DAILY_STOPS: 2
APPLY_RSI: true
RSI_OVERBOUGHT: 85
APPLY_BB: true
```

IDLE → BUY_PLACED → BOUGHT → TP_WAIT / SL_WAIT → (TP_FILLED | SL_FILLED)

if first_trade:
buy()
if pnl >= +0.3%: sell_all(); first_trade=false

loop:
if flat and price <= ref*(1-0.004): buy()
if long and price >= entry*(1+0.008): sell()

if long and price <= entry\*(1-0.008): stop_loss(); daily_stop++
if daily_stop >= 2: pause_until_next_day()

if every(30m): sell_all(); ref=current_price

if RSI>=85 or price>=BB.upper: sell_all()
if price<=BB.lower: buy()

notify_events()

4. 백테스트 & 검증

백테스트: 캔들 데이터로 PnL/승률/최대DD 검증

페이퍼 트레이딩: 실시간 시세 + 가상 체결

리스크 리밋: 하루 손실 한도, 최대 손절 횟수

실거래: 소액 → 점진적 증액

5. 운영 & 관제

장애 대응: API 오류/429 → 재시도 및 미체결 정리

로그/리포트: 일일 체결 요약, 에러 스택

배포: Docker + PM2, .env 분리, 키 보안

6. 일정 (예시)

주 1: API 래퍼, 상태머신, 기본 전략, 알림

주 2: 백테스트, 페이퍼 트레이딩, 파라미터 튜닝

주 3: 실거래 소액 런칭, 로그·안전장치 보강

주 4: 2차 기능(특수 조건, 간단 추세 판별)

7. 수용 기준

+0.8% TP / -0.8% SL / -0.4% 리바이 정확히 동작

30분 리셋 정상 작동

연속 손절 2회 시 거래 정지 + 알림

RSI/볼린저 강제 트리거 정상 작동

API 오류 시 중복 주문 없음

로그 및 일일 리포트 생성

8. 바로 다음 액션

심볼/기본 파라미터 결정 (예: KRW-BTC)

알림 채널 선정 (슬랙 추천)

실행 환경 결정 (VPS/Docker)

V1 코드 스캐폴딩 준비 (폴더 구조 + Upbit 래퍼 + 상태머신)
